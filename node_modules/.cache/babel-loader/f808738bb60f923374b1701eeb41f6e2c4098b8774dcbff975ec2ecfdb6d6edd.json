{"ast":null,"code":"import Konva from \"konva\";\nexport default {\n  data() {\n    return {\n      mode: \"brush\",\n      isPaint: false,\n      lastPointerPosition: null,\n      brushColor: \"#df4b26\",\n      stage: null,\n      layer: null,\n      canvas: null\n    };\n  },\n  mounted() {\n    const width = window.innerWidth;\n    const height = window.innerHeight - 25;\n\n    // Create Konva Stage and Layer\n    this.stage = new Konva.Stage({\n      container: this.$refs.container,\n      width: width,\n      height: height\n    });\n    this.layer = new Konva.Layer();\n    this.stage.add(this.layer);\n\n    // Create a canvas element and add it to the layer\n    this.canvas = document.createElement(\"canvas\");\n    this.canvas.width = this.stage.width();\n    this.canvas.height = this.stage.height();\n    const image = new Konva.Image({\n      image: this.canvas,\n      x: 0,\n      y: 0\n    });\n    this.layer.add(image);\n\n    // Get the 2D context\n    const context = this.canvas.getContext(\"2d\");\n    context.strokeStyle = this.brushColor; // Set the brush color\n\n    // Bind events\n    context.lineJoin = \"round\";\n    context.lineWidth = 5;\n\n    // Bind events\n    image.on(\"mousedown touchstart\", () => {\n      this.isPaint = true;\n      this.lastPointerPosition = this.stage.getPointerPosition();\n    });\n    this.stage.on(\"mouseup touchend\", () => {\n      this.isPaint = false;\n    });\n    this.stage.on(\"mousemove touchmove\", () => {\n      if (!this.isPaint) {\n        return;\n      }\n      if (this.mode === \"brush\") {\n        context.globalCompositeOperation = \"source-over\";\n      }\n      if (this.mode === \"eraser\") {\n        context.globalCompositeOperation = \"destination-out\";\n      }\n      context.beginPath();\n      const localPos = {\n        x: this.lastPointerPosition.x - image.x(),\n        y: this.lastPointerPosition.y - image.y()\n      };\n      context.moveTo(localPos.x, localPos.y);\n      const pos = this.stage.getPointerPosition();\n      const localPos2 = {\n        x: pos.x - image.x(),\n        y: pos.y - image.y()\n      };\n      context.lineTo(localPos2.x, localPos2.y);\n      context.closePath();\n      context.stroke();\n      this.lastPointerPosition = pos;\n      this.layer.batchDraw();\n    });\n  },\n  methods: {\n    updateBrushColor() {\n      // Handle color input changes here if needed\n      const context = this.canvas.getContext(\"2d\");\n      context.strokeStyle = this.brushColor;\n    },\n    clearCanvas() {\n      // Clear the entire canvas\n      const context = this.canvas.getContext(\"2d\");\n      context.clearRect(0, 0, this.stage.width(), this.stage.height());\n      this.layer.batchDraw();\n    },\n    exportCanvas() {\n      // Export the canvas as an image\n      const dataURL = this.canvas.toDataURL(\"image/png\");\n      const a = document.createElement(\"a\");\n      a.href = dataURL;\n      a.download = \"canvas_image.png\";\n      a.style.display = \"none\";\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    }\n  }\n};","map":{"version":3,"names":["Konva","data","mode","isPaint","lastPointerPosition","brushColor","stage","layer","canvas","mounted","width","window","innerWidth","height","innerHeight","Stage","container","$refs","Layer","add","document","createElement","image","Image","x","y","context","getContext","strokeStyle","lineJoin","lineWidth","on","getPointerPosition","globalCompositeOperation","beginPath","localPos","moveTo","pos","localPos2","lineTo","closePath","stroke","batchDraw","methods","updateBrushColor","clearCanvas","clearRect","exportCanvas","dataURL","toDataURL","a","href","download","style","display","body","appendChild","click","removeChild"],"sources":["/Users/lopesti/WebTeam/poc-konva-vue/src/components/KonvaDrawing.vue"],"sourcesContent":["<template>\n  <div class=\"container mt-5\">\n    <div class=\"row justify-content-center\">\n      <div class=\"col-8\">\n        <div class=\"border p-3\">\n          <div class=\"fs-3 fw-bold text-center\">Konva Drawing</div>\n          <div class=\"row mt-2\">\n            <div class=\"dropdown col-4\">\n              <button\n                class=\"btn btn-secondary dropdown-toggle\"\n                type=\"button\"\n                id=\"dropdownMenuButton\"\n                data-bs-toggle=\"dropdown\"\n                aria-expanded=\"false\"\n              >\n                Tool:\n              </button>\n              <ul class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n                <li>\n                  <a class=\"dropdown-item\" @click=\"mode = 'brush'\">Brush</a>\n                </li>\n                <li>\n                  <a class=\"dropdown-item\" @click=\"mode = 'eraser'\">Eraser</a>\n                </li>\n              </ul>\n            </div>\n            <div class=\"col-4\">\n              <button class=\"btn btn-danger\" @click=\"clearCanvas\">\n                Clear Canvas\n              </button>\n            </div>\n            <div class=\"col-4\">\n              <button class=\"btn btn-primary\" @click=\"exportCanvas\">\n                Export as Image\n              </button>\n            </div>\n          </div>\n          <div class=\"row d-flex justify-content-center\">\n            <div class=\"col-10\">\n              <input\n                type=\"color\"\n                v-model=\"brushColor\"\n                class=\"form-control mt-3\"\n                @input=\"updateBrushColor\"\n              />\n            </div>\n          </div>\n          <div ref=\"container\" class=\"drawing-area mt-3\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Konva from \"konva\";\n\nexport default {\n  data() {\n    return {\n      mode: \"brush\",\n      isPaint: false,\n      lastPointerPosition: null,\n      brushColor: \"#df4b26\",\n      stage: null,\n      layer: null,\n      canvas: null,\n    };\n  },\n  mounted() {\n    const width = window.innerWidth;\n    const height = window.innerHeight - 25;\n\n    // Create Konva Stage and Layer\n    this.stage = new Konva.Stage({\n      container: this.$refs.container,\n      width: width,\n      height: height,\n    });\n\n    this.layer = new Konva.Layer();\n    this.stage.add(this.layer);\n\n    // Create a canvas element and add it to the layer\n    this.canvas = document.createElement(\"canvas\");\n    this.canvas.width = this.stage.width();\n    this.canvas.height = this.stage.height();\n\n    const image = new Konva.Image({\n      image: this.canvas,\n      x: 0,\n      y: 0,\n    });\n    this.layer.add(image);\n\n    // Get the 2D context\n    const context = this.canvas.getContext(\"2d\");\n    context.strokeStyle = this.brushColor; // Set the brush color\n\n    // Bind events\n    context.lineJoin = \"round\";\n    context.lineWidth = 5;\n\n    // Bind events\n    image.on(\"mousedown touchstart\", () => {\n      this.isPaint = true;\n      this.lastPointerPosition = this.stage.getPointerPosition();\n    });\n\n    this.stage.on(\"mouseup touchend\", () => {\n      this.isPaint = false;\n    });\n\n    this.stage.on(\"mousemove touchmove\", () => {\n      if (!this.isPaint) {\n        return;\n      }\n      if (this.mode === \"brush\") {\n        context.globalCompositeOperation = \"source-over\";\n      }\n      if (this.mode === \"eraser\") {\n        context.globalCompositeOperation = \"destination-out\";\n      }\n      context.beginPath();\n\n      const localPos = {\n        x: this.lastPointerPosition.x - image.x(),\n        y: this.lastPointerPosition.y - image.y(),\n      };\n      context.moveTo(localPos.x, localPos.y);\n      const pos = this.stage.getPointerPosition();\n      const localPos2 = {\n        x: pos.x - image.x(),\n        y: pos.y - image.y(),\n      };\n      context.lineTo(localPos2.x, localPos2.y);\n      context.closePath();\n      context.stroke();\n\n      this.lastPointerPosition = pos;\n      this.layer.batchDraw();\n    });\n  },\n  methods: {\n    updateBrushColor() {\n      // Handle color input changes here if needed\n      const context = this.canvas.getContext(\"2d\");\n      context.strokeStyle = this.brushColor;\n    },\n    clearCanvas() {\n      // Clear the entire canvas\n      const context = this.canvas.getContext(\"2d\");\n      context.clearRect(0, 0, this.stage.width(), this.stage.height());\n      this.layer.batchDraw();\n    },\n    exportCanvas() {\n      // Export the canvas as an image\n      const dataURL = this.canvas.toDataURL(\"image/png\");\n      const a = document.createElement(\"a\");\n      a.href = dataURL;\n      a.download = \"canvas_image.png\";\n      a.style.display = \"none\";\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    },\n  },\n};\n</script>\n\n<style scoped></style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}